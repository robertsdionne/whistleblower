// main global script file

// Called when the game starts, before the first room is loaded
function game_start() {}


function repeatedly_execute() {
  // Put here anything you want to happen every game cycle, even when
  // the game is paused. This will not run when the game is blocked
  // inside a command like a blocking Walk()
  
  if (IsGamePaused() == 1) return;

  // Put here anything you want to happen every game cycle, but not
  // when the game is paused.
}


function repeatedly_execute_always() {
  // Put anything you want to happen every game cycle, even
  // when the game is blocked inside a command like a
  // blocking Walk().
  // You cannot run blocking commands from this function.  
}


function LoginButton_OnClick(GUIControl *control, MouseButton button) {
  MaybeLogin();
}


function show_inventory_window() {
  gInventory.Visible = true;
  // switch to the Use cursor (to select items with)
  mouse.Mode = eModeInteract;
  // But, override the appearance to look like the arrow
  mouse.UseModeGraphic(eModePointer);
}


// Called when a key is pressed. keycode holds the key's ASCII code
function on_key_press(eKeyCode keycode) {
  // The following is called before "if game is paused keycode=0", so
  // it'll happen even when the game is paused.

  if (IsGamePaused() || (IsInterfaceEnabled() == 0)) {
    // If the game is paused with a modal GUI on the
    // screen, or the player interface is disabled in
    // a cut scene, ignore any keypresses.
    return;
  }

  // FUNCTION KEYS AND SYSTEM SHORTCUTS
  if (keycode == eKeyEscape) {
    // ESC
    mouse.UseModeGraphic(eModePointer);
  }
  if (keycode == eKeyCtrlQ)  QuitGame(1);   // Ctrl-Q
  if (keycode == eKeyF12) SaveScreenShot("scrnshot.bmp");  // F12
}


function on_mouse_click(MouseButton button) {
  // called when a mouse button is clicked. button is either LEFT or RIGHT
  if (IsGamePaused() == 1) {
    // Game is paused, so do nothing (ie. don't allow mouse click)
  }
  else if (button == eMouseLeft) {
    ProcessClick(mouse.x, mouse.y, mouse.Mode );
  }
  else if (button == eMouseRight || button == eMouseWheelSouth){
    // right-click our mouse-wheel down, so cycle cursor
    mouse.SelectNextMode();
  }
  else if (button == eMouseMiddle) { 
    // Middle-button-click, default make character walk to clicked area (a little shortcut)
    // Could have been just "player.Walk(mouse.x,mouse.y)", but it's best to
    // leave our options open - what if you have a special script triggered
    // on "walking" mode?
    ProcessClick(mouse.x, mouse.y, eModeWalkto); 
  }
  else if (button == eMouseWheelNorth) { 
    // Mouse-wheel up, cycle cursors 
    // If mode isn't WALK, set the previous mode (notice usage of numbers instead
    // of eNums, when it suits us)...
    if (mouse.Mode>0) mouse.Mode=mouse.Mode-1; 
    else 
    { 
      // ...but if it is WALK mode...
      if (player.ActiveInventory!=null) 
      {
        //...and the player has a selected inventory item, set mouse mode to UseInv. 
        mouse.Mode=eModeUseinv; 
      }
      else 
      {
        // If they don't, however, just set it to mode TALK (change this line if you add more cursor modes)
        mouse.Mode=eModeTalkto; 
      }
    }
  }
}


function interface_click(int interface, int button) {
  // This function is obsolete, from 2.62 and earlier versions.
}


function btnInvUp_Click(GUIControl *control, MouseButton button) {
  invCustomInv.ScrollUp();
}


function btnInvDown_Click(GUIControl *control, MouseButton button) {
  invCustomInv.ScrollDown();
}


function btnInvOK_Click(GUIControl *control, MouseButton button) {
	// They pressed the OK button, close the GUI
	gInventory.Visible = false;
	mouse.UseDefaultGraphic();
}


function btnInvSelect_Click(GUIControl *control, MouseButton button) {
	// They pressed SELECT, so switch to the Get cursor
	mouse.Mode = eModeInteract;
	// But, override the appearance to look like the arrow
	mouse.UseModeGraphic(eModePointer);
}


function btnIconInv_Click(GUIControl *control, MouseButton button) {
  show_inventory_window();
}


function btnIconCurInv_Click(GUIControl *control, MouseButton button) {
  if (player.ActiveInventory != null)
    mouse.Mode = eModeUseinv;
}


function cEgo_Look() {
  Display("Damn, I'm looking good!");
}


function cEgo_Interact() {
  Display("You rub your hands up and down your clothes.");
}


function cEgo_Talk() {
  Display("Talking to yourself is a sign of madness!");
}


function dialog_request(int param)  {
  // This is used by the dialog text parser if you need to process
  // text that the player types in to the parser.
  // It is not used by default.
}


function CloseButton_OnClick(GUIControl *control, MouseButton button) {
  control.OwningGUI.Visible = false;
}

function gMailNextButton1_OnClick(GUIControl *control, MouseButton button) {
  CloseButton_OnClick(control, button);
  gMail = gMail2;
  gMail.Visible = true;
}

function MailNextButton2_OnClick(GUIControl *control, MouseButton button) {
  CloseButton_OnClick(control, button);
  gMail = gMail3;
  gMail.Visible = true;
}

function MailPrevButton2_OnClick(GUIControl *control, MouseButton button) {
  CloseButton_OnClick(control, button);
  gMail = gMail1;
  gMail.Visible = true;
}

function MailNextButton3_OnClick(GUIControl *control, MouseButton button) {
  CloseButton_OnClick(control, button);
  gMail = gMail4;
  gMail.Visible = true;
}

function MailPrevButton3_OnClick(GUIControl *control, MouseButton button) {
  CloseButton_OnClick(control, button);
  gMail = gMail2;
  gMail.Visible = true;
}

function MailPrevButton4_OnClick(GUIControl *control, MouseButton button) {
  CloseButton_OnClick(control, button);
  gMail = gMail3;
  gMail.Visible = true;
}

function gDocument_OnClick(GUI *theGui, MouseButton button) {
  Raise(theGui);
}
